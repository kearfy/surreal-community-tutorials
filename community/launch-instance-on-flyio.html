<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Running a SurrealDB Instance on Fly.io - SurrealDB tutorials</title>
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="../favicon.svg">
                        <link rel="shortcut icon" href="../favicon.png">
                <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
                <link rel="stylesheet" href="../css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="../fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">Introduction</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Official guides</li><li class="chapter-item expanded "><a href="../official/00-SUMMARY.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">Community guides</li><li class="chapter-item expanded "><a href="../community/00-SUMMARY.html"><strong aria-hidden="true">2.</strong> Introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../community/cloudflare-worker-with-surrealdb.html"><strong aria-hidden="true">2.1.</strong> Cloudflare worker with SurrealDB</a></li><li class="chapter-item expanded "><a href="../community/host-with-docker-compose.html"><strong aria-hidden="true">2.2.</strong> Host with docker compose</a></li><li class="chapter-item expanded "><a href="../community/how-to-use-signin-and-signup.html"><strong aria-hidden="true">2.3.</strong> How to use signin and signup</a></li><li class="chapter-item expanded "><a href="../community/launch-instance-on-flyio.html" class="active"><strong aria-hidden="true">2.4.</strong> Running a SurrealDB Instance on Fly.io</a></li></ol></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">
                        <img src="/assets/repo-assets/logo-white.svg" alt="">
                    </h1>

                    <div class="right-buttons">
                                                <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <br>
    <h1 align="center">Running a SurrealDB Instance on Fly.io</h1>
<br>
<hr />
<p>
    Tutorial by <a href="https://github.com/intabulas" target="_blank">Mark Lussier</a>.<br>
    Edit this tutorial on <a href="https://github.com/surrealdb/tutorials/blob/main/community/launch-instance-on-flyio.md">GitHub</a>.
</p>
<hr />
<br>
<p>These are the steps for getting a <a href="https://surrealdb.com/">surrealdb</a> instance running on <a href="https://fly.io/">fly.io</a> and connecting to it. This is <strong>heavily</strong> based off of steps posted in the surrealdb discord by rvdende. <a href="https://discord.com/channels/902568124350599239/1022387563627028511/1022928762947514449">View Original Post</a>.</p>
<p>These steps work just fine for the hobby (pay as you go) plan.</p>
<p><strong>HEADS UP</strong> By default this will create an instance on a single shared cpu with 256m memory. This is pretty darn small to do anything but experiment, but its free. You can scale your instance to something more useable by visiting the <code>https://fly.io/apps/&lt;appname&gt;/scale</code>. Obviously scaling to larger instances will incur higher costs, please refer to <a href="https://fly.io/docs/about/pricing/">fly.io pricing</a></p>
<h3 id="installing-flyio-client"><a class="header" href="#installing-flyio-client">Installing fly.io client</a></h3>
<p>source: <a href="https://fly.io/docs/hands-on/install-flyctl/">fly.io docs</a></p>
<pre><code class="language-bash">brew install flyctl
</code></pre>
<h3 id="optionally-create-a-free-account-if-needed"><a class="header" href="#optionally-create-a-free-account-if-needed">Optionally create a free account if needed</a></h3>
<p>source: <a href="https://fly.io/docs/hands-on/sign-up/">fly.io docs</a></p>
<pre><code class="language-bash">flyctl auth signup
</code></pre>
<h3 id="login-to-your-flyio-account"><a class="header" href="#login-to-your-flyio-account">Login to your fly.io account</a></h3>
<p>source: <a href="https://fly.io/docs/hands-on/sign-in/">fly.io docs</a></p>
<pre><code class="language-bash">flyctl auth login
</code></pre>
<h2 id="create-a-dockerfile-to-run-surrealdb"><a class="header" href="#create-a-dockerfile-to-run-surrealdb">Create a Dockerfile to run SurrealDB</a></h2>
<p>Create a directory locally, cd into it and create a new <code>Dockerfile</code>. Note we aren't providing a root user username/password to the start command, we will be providing those as environment variables.</p>
<pre><code class="language-docker">FROM surrealdb/surrealdb:latest
EXPOSE 8080
CMD [&quot;start&quot;, &quot;--bind&quot;, &quot;0.0.0.0:8080&quot;, &quot;file://data/srdb.db&quot;]
</code></pre>
<h3 id="launch-your-instance-sort-of-"><a class="header" href="#launch-your-instance-sort-of-">Launch your Instance.. sort of :)</a></h3>
<pre><code class="language-sh">fly launch
</code></pre>
<p>You will be prompted with various questions. Give your app a memorable name since it will be used in the URL. Pick a region close to you and most importantly, answer NO when prompted if you wish to deploy immediately.</p>
<h3 id="create-a-volume"><a class="header" href="#create-a-volume">Create a volume</a></h3>
<p>We need to create a volume for surreal to write the database to. Lets create a small 1g volume. Right now you can not scale a volume (you need to create a new one), but fly.io is working on supporting this. You can get up a total of 3g of persistent volume storage (total) for free.</p>
<pre><code class="language-bash">fly volumes create data --region &lt;region&gt; --size 1
</code></pre>
<p>Now lets edit the <code>fly.toml</code> file that was created by <code>fly launch</code>. Put this at the end, no indentations or spaces.</p>
<pre><code class="language-toml">[mounts]
source=&quot;data&quot;
destination=&quot;/data&quot;
</code></pre>
<h3 id="secrets"><a class="header" href="#secrets">Secrets</a></h3>
<p>Now lets add our username and password as secrets. You can see the environment variables surrealdb supports by running <code>surreal start -h</code></p>
<pre><code class="language-bash">fly secrets set USER=root
fly secrets set PASS=&lt;passwordhere&gt;
</code></pre>
<h3 id="lets-deploy"><a class="header" href="#lets-deploy">Let's Deploy</a></h3>
<pre><code class="language-bash">fly deploy
</code></pre>
<h3 id="connecting"><a class="header" href="#connecting">Connecting</a></h3>
<p>Now that your surrealdb instance is up and running, you need to be able to connect to it. Even though we exposed port 8080 in the Dockerfile, fly will map that appropriatly to port 80/443.</p>
<p>If you're connecting via a websocket client library, surrealdb-go in my case, you would connect with the following. Note the use of <code>wss://</code></p>
<pre><code class="language-go">db, err := surrealdb.New(&quot;wss://&lt;appname&gt;.fly.dev/rpc&quot;)
if err != nil {
	fmt.Printf(&quot;error creating socket: %s&quot;, err)
	os.Exit(2)
}
</code></pre>
<h3 id="surreal-sql-command"><a class="header" href="#surreal-sql-command">Surreal sql Command</a></h3>
<p>If you're connecting via the surreal cli, use a connection string with <code>--conn https://&lt;appname&gt;.fly.dev</code>. Please don't forget to pass <code>--user</code>/<code>--pass</code> with the values you used when creating secrets.</p>
<h3 id="third-party-tools-such-as-rvdendes-a-hrefhttpssurrealreactflydevsurrealreacta"><a class="header" href="#third-party-tools-such-as-rvdendes-a-hrefhttpssurrealreactflydevsurrealreacta">Third Party tools such as rvdende's <a href="https://surrealreact.fly.dev/">surrealreact</a></a></h3>
<p>When creating a connection, specify the host as <code>https://&lt;appname&gt;.fly.dev/rpc</code></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                                                    <a rel="prev" href="../community/how-to-use-signin-and-signup.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                                    <a rel="prev" href="../community/how-to-use-signin-and-signup.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        
    </body>
</html>
