<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>SurrealDB tutorials</title>
                <meta name="robots" content="noindex" />
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="favicon.svg">
                        <link rel="shortcut icon" href="favicon.png">
                <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
                <link rel="stylesheet" href="css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Introduction</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Official guides</li><li class="chapter-item expanded "><a href="official/00-SUMMARY.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">Community guides</li><li class="chapter-item expanded "><a href="community/00-SUMMARY.html"><strong aria-hidden="true">2.</strong> Introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="community/cloudflare-worker-with-surrealdb.html"><strong aria-hidden="true">2.1.</strong> Cloudflare worker with SurrealDB</a></li><li class="chapter-item expanded "><a href="community/host-with-docker-compose.html"><strong aria-hidden="true">2.2.</strong> Host with docker compose</a></li><li class="chapter-item expanded "><a href="community/how-to-use-signin-and-signup.html"><strong aria-hidden="true">2.3.</strong> How to use signin and signup</a></li><li class="chapter-item expanded "><a href="community/launch-instance-on-flyio.html"><strong aria-hidden="true">2.4.</strong> Running a SurrealDB Instance on Fly.io</a></li></ol></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">
                        <img src="/assets/repo-assets/logo-white.svg" alt="">
                    </h1>

                    <div class="right-buttons">
                                                <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <br>
<p align="center">
    <a href="https://github.com/surrealdb/tutorials#gh-dark-mode-only" target="_blank">
        <img width="300" src="assets/repo-assets/logo-white.svg" alt="SurrealDB Logo">
    </a>
    <a href="https://github.com/surrealdb/tutorials#gh-light-mode-only" target="_blank">
        <img width="300" src="assets/repo-assets/logo-black.svg" alt="SurrealDB Logo">
    </a>
</p>
<p align="center">Welcome to the tutorials repository for SurrealDB, with official and community contributed tutorials.</p>
<h4 id="official-tutorials"><a class="header" href="#official-tutorials">Official tutorials</a></h4>
<p>To view the official tutorials and code walkthroughs, view the <a href="https://github.com/surrealdb/tutorials/tree/main/official"><code>official</code></a> folder in this repository.</p>
<h4 id="community-tutorials"><a class="header" href="#community-tutorials">Community tutorials</a></h4>
<p>To view the community-submitted tutorials and code walkthroughs, view the <a href="https://github.com/surrealdb/tutorials/tree/main/community"><code>community</code></a> folder in this repository.</p>
<h4 id="contributing"><a class="header" href="#contributing">Contributing</a></h4>
<p>If you would like to make a contribution, please follow the instructions in the Contribution Guidelines and then open a Pull-Request. One of the community managers will then evaluate your tutorial, and provide you with feedback.</p>
<p>Due to the way we set up the repo you only need to create <strong>ONE</strong> file, which is your guide itself (outside of images/assets). Please include the configuration bit in the top of the template file and don't change it's structure, else the github action will fail.</p>
<div style="break-before: page; page-break-before: always;"></div><br>
    <h1 align="center">Official guides</h1>
<br>
<p>Only SurrealDB staff are allowed to create guides here. If you have a guide which we think will fit in the official category, we will propose this to the surrealdb team <em>for</em> you.</p>
<br>
<hr />
<h2 id="guides"><a class="header" href="#guides">Guides</a></h2>
<div style="break-before: page; page-break-before: always;"></div><br>
    <h1 align="center">Community guides</h1>
<br>
<p>Please follow the contribution guidelines when creating a new guide:</p>
<ul>
<li>A Pull Request will be rejected if it's subject is wider than about only one guide.</li>
<li>Please follow the template file and keep the top configuration in the same order. Otherwise the test will fail and it will <strong>not</strong> build.</li>
<li>If you think something can be done better about the repository, please open an issue first to discuss the matter! It will create a mess if everybody opens a PR for small improvements to be rejected.</li>
<li><strong>Note</strong>: Because of the way we built the repo, your PR only needs to contain <strong>one</strong> file, which is the guide itself (outside of potential images). All other changes <strong>will be rejected</strong>.</li>
</ul>
<br>
<hr />
<h2 id="guides-1"><a class="header" href="#guides-1">Guides</a></h2>
<ul>
<li><a href="community/cloudflare-worker-with-surrealdb.html">Cloudflare worker with SurrealDB</a> - <a href="https://github.com/kearfy">Micha de Vries</a></li>
<li><a href="community/host-with-docker-compose.html">Host with docker compose</a> - <a href="https://github.com/kearfy">Micha de Vries</a></li>
<li><a href="community/how-to-use-signin-and-signup.html">How to use signin and signup</a> - <a href="https://github.com/koakh">Koakh</a></li>
<li><a href="community/launch-instance-on-flyio.html">Running a SurrealDB Instance on Fly.io</a> - <a href="https://github.com/intabulas">Mark Lussier</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><br>
    <h1 align="center">Cloudflare worker with SurrealDB</h1>
<br>
<hr />
<p>
    Tutorial by <a href="https://github.com/kearfy" target="_blank">Micha de Vries</a>.<br>
    Edit this tutorial on <a href="https://github.com/surrealdb/tutorials/blob/main/community/cloudflare-worker-with-surrealdb.md">GitHub</a>.
</p>
<hr />
<br>
<p>I am building an <a href="https://kards.social">open-source social media platform</a> with cloudflare workers. Internally, we we're in debate between projects like <a href="https://blog.cloudflare.com/introducing-d1/">Cloudflare D1</a> and <a href="https://planetscale.com">Planetscale</a> but eventually we stumbled upon <a href="https://surrealdb.com">SurrealDB</a>. It really made a lot of sense for our project, so we went with it!</p>
<p>To be able to achieve this, we built <a href="https://github.com/theopensource-company/surrealdb-cloudflare">our own database driver</a>, which is also available via <a href="https://www.npmjs.com/package/@theopensource-company/surrealdb-cloudflare">NPM</a>.</p>
<p>Below follow a few examples on how to use the database drivers with cloudflare workers. In these examples we use the worker typescript template.</p>
<h3 id="connection-variables-from-environment"><a class="header" href="#connection-variables-from-environment">Connection variables from environment</a></h3>
<pre><code class="language-typescript">import Surreal from '@theopensource-company/surrealdb-cloudflare';

// Type safety, typescript example :D
type Env = {
    HOST: string;
    USER: string;
    PASS: string;
    NAMESPACE: string;
    DATABASE: string;
}

// We can update the connection variables later on, as we don't have them available here just yet...
const db = new Surreal();

export default {
	async fetch(
		request: Request,
        env: Env
	): Promise&lt;Response&gt; {
        // If database not yet connected, let's update the connection details.
        if (!db.connected()) db.connect({
            host: env.HOST ?? '',
            username: env.USER ?? '',
            password: env.PASS ?? '',
            namespace: env.NAMESPACE ?? '',
            database: env.DATABASE ?? ''
        });

        // Example query: Retrieves all records from table 'table'.
        let res = await db.getRecords('table');
		console.log(res[0].result);

		return new Response(&quot;Hello World!&quot;);
	},
};
</code></pre>
<h3 id="connection-variables-defined-in-code"><a class="header" href="#connection-variables-defined-in-code">Connection variables defined in code</a></h3>
<pre><code class="language-typescript">import Surreal from '@theopensource-company/surrealdb-cloudflare';

// We can update the connection variables later on, as we don't have them available here just yet...
const db = new Surreal({
    host: 'http://surreal.domain.com',
    username: 'root',
    password: 'password',
    namespace: 'awesome',
    database: 'example'
});

export default {
	async fetch(
		request: Request
	): Promise&lt;Response&gt; {
        // Example query: Retrieves all records from table 'table'.
        let res = await db.getRecords('table');
		console.log(res[0].result);

		return new Response(&quot;Hello World!&quot;);
	},
};
</code></pre>
<h3 id="strong-type-result"><a class="header" href="#strong-type-result">Strong type result</a></h3>
<pre><code class="language-typescript">const res = await db.getRecords&lt;{
    id: string;
    username: string;
    status: &quot;verified&quot; | &quot;unverified&quot;;
}&gt;('user');

res.forEach(record =&gt; {
    // Everything in &quot;result&quot; is now strong typed with the defined type.
    const { result: {
        id,
        username,
        status
    } } = record;
    console.log(`${id} - User ${username} is ${status}`);
});
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><br>
    <h1 align="center">Host with docker compose</h1>
<br>
<hr />
<p>
    Tutorial by <a href="https://github.com/kearfy" target="_blank">Micha de Vries</a>.<br>
    Edit this tutorial on <a href="https://github.com/surrealdb/tutorials/blob/main/community/host-with-docker-compose.md">GitHub</a>.
</p>
<hr />
<br>
<p>As of writing this tutorial, Surreal Cloud is not yet available. For our project (which is currently heavily in development) we need to have an online instance of surrealdb available, so we have resided to a Hetzner VPS with docker-compose to keep it all clean and tidy.</p>
<p>What follows beyond here is a boiler plate with a very basic docker-compose instance, and the way we have deployed it.</p>
<br>
<h2 id="basic-no-ssl"><a class="header" href="#basic-no-ssl">Basic, no SSL</a></h2>
<pre><code class="language-yaml">version: '3'

services:
  surrealdb:
    image: surrealdb/surrealdb:latest
    container_name: surrealdb
    restart: always
    command: start --user INSERT_USERNAME_HERE --pass INSERT_PASSWORD_HERE file:/data/database.db
    ports:
      - 8000:8000
    volumes:
      - ./data:/data
</code></pre>
<br>
<h2 id="our-deployment"><a class="header" href="#our-deployment">Our deployment</a></h2>
<p>We don't need any automatic SSL generation as we use an SSL provided by cloudflare for our origin server, but feel free to add another template to this guide which automatically requests an SSL from Let's encrypt!</p>
<pre><code class="language-yaml">version: '3'

services:
  surrealdb:
    image: surrealdb/surrealdb:latest
    container_name: surrealdb
    restart: always
    command: start --user INSERT_USERNAME_HERE --pass INSERT_PASSWORD_HERE --web-crt /data/web.crt --web-key /data/web.key file:/data/database.db
    ports:
      - 443:8000
    volumes:
      - ./data:/data
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><br>
    <h1 align="center">How to use signin and signup</h1>
<br>
<hr />
<p>
    Tutorial by <a href="https://github.com/koakh" target="_blank">Koakh</a>.<br>
    Edit this tutorial on <a href="https://github.com/surrealdb/tutorials/blob/main/community/how-to-use-signin-and-signup.md">GitHub</a>.
</p>
<hr />
<br>
<h2 id="start-inmemory-server"><a class="header" href="#start-inmemory-server">Start InMemory Server</a></h2>
<pre><code class="language-shell">$ surreal start --log trace --user root --pass root
</code></pre>
<h2 id="option-1-schemafull"><a class="header" href="#option-1-schemafull">Option #1: SCHEMAFULL</a></h2>
<p>launch surreal REPL to connect to local SurrealDB server instance</p>
<pre><code class="language-shell">$ surreal sql --conn http://localhost:8000 --user root --pass root --ns test --db test --pretty
</code></pre>
<p>now paste bellow surrealQL code block to create the schemafull scheme</p>
<pre><code class="language-sql">---define SCHEMAFULL and PERMISSIONS
DEFINE TABLE user SCHEMAFULL
  PERMISSIONS
    FOR select, update WHERE id = $auth.id, 
    FOR create, delete NONE;
--- define FIELD's
DEFINE FIELD user ON user TYPE string;
DEFINE FIELD pass ON user TYPE string;
DEFINE FIELD settings.* ON user TYPE object;
DEFINE FIELD settings.marketing ON user TYPE string;
DEFINE FIELD tags ON user TYPE array;
--- define INDEX's
DEFINE INDEX idx_user ON user COLUMNS user UNIQUE;

-- define SCOPE
DEFINE SCOPE allusers
  -- the JWT session will be valid for 14 days
  SESSION 14d
  -- The optional SIGNUP clause will be run when calling the signup method for this scope
  -- It is designed to create or add a new record to the database.
  -- If set, it needs to return a record or a record id
  -- The variables can be passed in to the signin method
  SIGNUP ( CREATE user SET settings.marketing = $marketing, user = $user, pass = crypto::argon2::generate($pass), tags = $tags )
  -- The optional SIGNIN clause will be run when calling the signin method for this scope
  -- It is designed to check if a record exists in the database.
  -- If set, it needs to return a record or a record id
  -- The variables can be passed in to the signin method
  SIGNIN ( SELECT * FROM user WHERE user = $user AND crypto::argon2::compare(pass, $pass) )
  -- this optional clause will be run when calling the signup method for this scope
</code></pre>
<p>check info db in REPL</p>
<pre><code class="language-sql">&gt; INFO FOR DB;
[
  {
    &quot;result&quot;: {
      &quot;dl&quot;: {},
      &quot;dt&quot;: {},
      &quot;sc&quot;: {
        &quot;allusers&quot;: &quot;DEFINE SCOPE allusers SESSION 2w SIGNUP (CREATE user SET settings.marketing = $marketing, user = $user, pass = crypto::argon2::generate($pass), tags = $tags) SIGNIN (SELECT * FROM user WHERE user = $user AND crypto::argon2::compare(pass, $pass))&quot;
      },
      &quot;tb&quot;: {
        &quot;user&quot;: &quot;DEFINE TABLE user SCHEMAFULL PERMISSIONS FOR select WHERE id = $auth.id, FOR create NONE, FOR update WHERE id = $auth.id, FOR delete NONE&quot;
      }
    },
    &quot;status&quot;: &quot;OK&quot;,
    &quot;time&quot;: &quot;153.601µs&quot;
  }
]
</code></pre>
<h2 id="option-2--schemaless"><a class="header" href="#option-2--schemaless">Option #2 : SCHEMALESS</a></h2>
<p>another nice option suggested by <a href="https://gist.github.com/georgyo">George Shammas / georgyo</a></p>
<pre><code class="language-sql">DEFINE SCOPE allusers 
SESSION 14d
SIGNUP (
  CREATE type::thing(&quot;user&quot;, string::lowercase(string::trim($user)))
  SET pass = crypto::argon2::generate($pass)
)
SIGNIN (
  SELECT * FROM type::thing(&quot;user&quot;, string::lowercase(string::trim($user)))
  WHERE crypto::argon2::compare(pass, $pass)
)
</code></pre>
<p>Because we are <strong>reusing the id, the username unique constraint is enforced</strong> even in a SCHEMALESS table.</p>
<p>However this also means that <strong>username will not be changeable in the future</strong> as all relationships will be using the old username as the key.</p>
<p>check info db in REPL</p>
<pre><code class="language-sql">&gt; INFO FOR DB;
[
  {
    &quot;result&quot;: {
      &quot;dl&quot;: {},
      &quot;dt&quot;: {},
      &quot;sc&quot;: {
        &quot;allusers&quot;: &quot;DEFINE SCOPE allusers SESSION 2w SIGNUP (CREATE type::thing(\&quot;user\&quot;, string::lowercase(string::trim($user))) SET pass = crypto::argon2::generate($pass)) SIGNIN (SELECT * FROM type::thing(\&quot;user\&quot;, string::lowercase(string::trim($user))) WHERE crypto::argon2::compare(pass, $pass))&quot;
      },
      &quot;tb&quot;: {
        &quot;user&quot;: &quot;DEFINE TABLE user SCHEMALESS PERMISSIONS NONE&quot;
      }
    },
    &quot;status&quot;: &quot;OK&quot;,
    &quot;time&quot;: &quot;93.978µs&quot;
  }
]

&gt; SELECT * FROM user;
[
  {
    &quot;result&quot;: [
      {
        &quot;id&quot;: &quot;user:tobie&quot;,
        &quot;pass&quot;: &quot;$argon2id$v=19$m=4096,t=3,p=1$oFQ8a4HFXjfaadQcOdPlLw$MZrA6mNvtvFLuQq1GGhfrGs4wk9iflhKT2rRsZLxwE4&quot;
      }
    ],
    &quot;status&quot;: &quot;OK&quot;,
    &quot;time&quot;: &quot;125.017µs&quot;
  }
]
</code></pre>
<h2 id="test-signin-and-signup-with-javascript-surrealdbjs-integration"><a class="header" href="#test-signin-and-signup-with-javascript-surrealdbjs-integration">Test signin and signup with Javascript surrealdb.js integration</a></h2>
<p>use following query from the client to <strong>signup a new user</strong></p>
<pre><code class="language-js">db.signup({
  NS: 'my_ns',
  DB: 'my_db',
  // We want to signup to the 'allusers' scope defined above
  SC: 'allusers',
  // We can add any variable here to use in the SIGNUP clause
  user: 'tobie',
  // We can add any variable here to use in the SIGNUP clause
  pass: 'some password',
  // We can add any variable here to use in the SIGNUP clause
  marketing: true,
  // We can add any variable here to use in the SIGNUP clause
  tags: ['rust', 'golang', 'javascript'],
});
</code></pre>
<p>you should receive a jwt token for ex</p>
<pre><code>eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzUxMiJ9.eyJpYXQiOjE2NjQyMjQxMjEsIm5iZiI6MTY2NDIyNDEyMSwiZXhwIjoxNjY1NDMzNzIxLCJpc3MiOiJTdXJyZWFsREIiLCJucyI6InRlc3QiLCJkYiI6InRlc3QiLCJzYyI6ImFsbHVzZXJzIiwiaWQiOiJ1c2VyOmQ4dzR4aHZtY2hxcHh6enl5ZjUyIn0.TWjIEm8z2TeuE27uJ9MvgfCELvOT0hC6e8vlOPUNJMx-lvxYXIYgXXcibdVxEWNQqnXu1gaUOus4KgjsWaUD-A
</code></pre>
<p>and <strong>signin an existing user</strong></p>
<pre><code class="language-js">db.signin({
  NS: 'my_ns',
  DB: 'my_db',
  // We want to signup to the 'allusers' scope defined above
  SC: 'allusers',
  // We can add any variable here to use in the SIGNUP clause
  user: 'tobie',
  // We can add any variable here to use in the SIGNUP clause
  pass: 'some password',
});
</code></pre>
<p>you should receive a jwt token for ex</p>
<pre><code>eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzUxMiJ9.eyJpYXQiOjE2NjQyMjQxNjMsIm5iZiI6MTY2NDIyNDE2MywiZXhwIjoxNjY1NDMzNzYzLCJpc3MiOiJTdXJyZWFsREIiLCJucyI6InRlc3QiLCJkYiI6InRlc3QiLCJzYyI6ImFsbHVzZXJzIiwiaWQiOiJ1c2VyOmQ4dzR4aHZtY2hxcHh6enl5ZjUyIn0.kKx_WShYBf9T_sCa_pRldHTG9LyfIx-4q0V4sz2kKzxSG4b_okG-MddTwdqHnsdS7rEJxZ-Gp-iP4cpgo77kqQ
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><br>
    <h1 align="center">Running a SurrealDB Instance on Fly.io</h1>
<br>
<hr />
<p>
    Tutorial by <a href="https://github.com/intabulas" target="_blank">Mark Lussier</a>.<br>
    Edit this tutorial on <a href="https://github.com/surrealdb/tutorials/blob/main/community/launch-instance-on-flyio.md">GitHub</a>.
</p>
<hr />
<br>
<p>These are the steps for getting a <a href="https://surrealdb.com/">surrealdb</a> instance running on <a href="https://fly.io/">fly.io</a> and connecting to it. This is <strong>heavily</strong> based off of steps posted in the surrealdb discord by rvdende. <a href="https://discord.com/channels/902568124350599239/1022387563627028511/1022928762947514449">View Original Post</a>.</p>
<p>These steps work just fine for the hobby (pay as you go) plan.</p>
<p><strong>HEADS UP</strong> By default this will create an instance on a single shared cpu with 256m memory. This is pretty darn small to do anything but experiment, but its free. You can scale your instance to something more useable by visiting the <code>https://fly.io/apps/&lt;appname&gt;/scale</code>. Obviously scaling to larger instances will incur higher costs, please refer to <a href="https://fly.io/docs/about/pricing/">fly.io pricing</a></p>
<h3 id="installing-flyio-client"><a class="header" href="#installing-flyio-client">Installing fly.io client</a></h3>
<p>source: <a href="https://fly.io/docs/hands-on/install-flyctl/">fly.io docs</a></p>
<pre><code class="language-bash">brew install flyctl
</code></pre>
<h3 id="optionally-create-a-free-account-if-needed"><a class="header" href="#optionally-create-a-free-account-if-needed">Optionally create a free account if needed</a></h3>
<p>source: <a href="https://fly.io/docs/hands-on/sign-up/">fly.io docs</a></p>
<pre><code class="language-bash">flyctl auth signup
</code></pre>
<h3 id="login-to-your-flyio-account"><a class="header" href="#login-to-your-flyio-account">Login to your fly.io account</a></h3>
<p>source: <a href="https://fly.io/docs/hands-on/sign-in/">fly.io docs</a></p>
<pre><code class="language-bash">flyctl auth login
</code></pre>
<h2 id="create-a-dockerfile-to-run-surrealdb"><a class="header" href="#create-a-dockerfile-to-run-surrealdb">Create a Dockerfile to run SurrealDB</a></h2>
<p>Create a directory locally, cd into it and create a new <code>Dockerfile</code>. Note we aren't providing a root user username/password to the start command, we will be providing those as environment variables.</p>
<pre><code class="language-docker">FROM surrealdb/surrealdb:latest
EXPOSE 8080
CMD [&quot;start&quot;, &quot;--bind&quot;, &quot;0.0.0.0:8080&quot;, &quot;file://data/srdb.db&quot;]
</code></pre>
<h3 id="launch-your-instance-sort-of-"><a class="header" href="#launch-your-instance-sort-of-">Launch your Instance.. sort of :)</a></h3>
<pre><code class="language-sh">fly launch
</code></pre>
<p>You will be prompted with various questions. Give your app a memorable name since it will be used in the URL. Pick a region close to you and most importantly, answer NO when prompted if you wish to deploy immediately.</p>
<h3 id="create-a-volume"><a class="header" href="#create-a-volume">Create a volume</a></h3>
<p>We need to create a volume for surreal to write the database to. Lets create a small 1g volume. Right now you can not scale a volume (you need to create a new one), but fly.io is working on supporting this. You can get up a total of 3g of persistent volume storage (total) for free.</p>
<pre><code class="language-bash">fly volumes create data --region &lt;region&gt; --size 1
</code></pre>
<p>Now lets edit the <code>fly.toml</code> file that was created by <code>fly launch</code>. Put this at the end, no indentations or spaces.</p>
<pre><code class="language-toml">[mounts]
source=&quot;data&quot;
destination=&quot;/data&quot;
</code></pre>
<h3 id="secrets"><a class="header" href="#secrets">Secrets</a></h3>
<p>Now lets add our username and password as secrets. You can see the environment variables surrealdb supports by running <code>surreal start -h</code></p>
<pre><code class="language-bash">fly secrets set USER=root
fly secrets set PASS=&lt;passwordhere&gt;
</code></pre>
<h3 id="lets-deploy"><a class="header" href="#lets-deploy">Let's Deploy</a></h3>
<pre><code class="language-bash">fly deploy
</code></pre>
<h3 id="connecting"><a class="header" href="#connecting">Connecting</a></h3>
<p>Now that your surrealdb instance is up and running, you need to be able to connect to it. Even though we exposed port 8080 in the Dockerfile, fly will map that appropriatly to port 80/443.</p>
<p>If you're connecting via a websocket client library, surrealdb-go in my case, you would connect with the following. Note the use of <code>wss://</code></p>
<pre><code class="language-go">db, err := surrealdb.New(&quot;wss://&lt;appname&gt;.fly.dev/rpc&quot;)
if err != nil {
	fmt.Printf(&quot;error creating socket: %s&quot;, err)
	os.Exit(2)
}
</code></pre>
<h3 id="surreal-sql-command"><a class="header" href="#surreal-sql-command">Surreal sql Command</a></h3>
<p>If you're connecting via the surreal cli, use a connection string with <code>--conn https://&lt;appname&gt;.fly.dev</code>. Please don't forget to pass <code>--user</code>/<code>--pass</code> with the values you used when creating secrets.</p>
<h3 id="third-party-tools-such-as-rvdendes-a-hrefhttpssurrealreactflydevsurrealreacta"><a class="header" href="#third-party-tools-such-as-rvdendes-a-hrefhttpssurrealreactflydevsurrealreacta">Third Party tools such as rvdende's <a href="https://surrealreact.fly.dev/">surrealreact</a></a></h3>
<p>When creating a connection, specify the host as <code>https://&lt;appname&gt;.fly.dev/rpc</code></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
                        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
                
    </body>
</html>
